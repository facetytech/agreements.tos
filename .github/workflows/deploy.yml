
name: To GCS


on:

  push:
    branches:
      - main
    tags:
      - '*'


jobs:

  upload:
    
    permissions:
      contents: 'read'
      id-token: 'write'

    runs-on: ubuntu-latest
    
    steps:

    - name: Checkout private tools
      uses: actions/checkout@v3
      with:
        repository: facetytech/ci
        token: ${{ secrets.CI_TOKEN }}
        path: ga

    - name: Checkout & Login & Upload
      uses: ./ga/other/deploy-agreements@main
      with:
        project-id: ${{ vars.GCP_DATA_PROJECT_ID }}
        project-num: ${{ secrets.GCP_DATA_PROJECT_NUM }}
        wif-pool: ${{ secrets.GCP_DATA_WIF_POOL }}
        wif-provider: ${{ secrets.GCP_DATA_WIF_PROVIDER_GITHUB }}
        service-account: ${{ secrets.GCP_PIPELINE_LOGIN }}
        target-bucket: ${{ secrets.GCP_AGREEMENTS_BUCKET_FACETY }}
        from-path: ./text
        type: tos
        version: ${GITHUB_REF#refs/tags/}
